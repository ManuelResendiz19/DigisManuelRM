<html xmlns:th="http://www.thyemleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<!--    <head>
        <title>Formulario Usuario</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
            <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script><script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
            
            
          
    </head>-->
<body layout:fragment="body" class="bg-light">

  <div class="container py-5">
    <div class="card shadow border-0">
      <div class="card-body p-4">
        <h3 class="card-title text-center mb-4 text-primary fw-bold">Registro de Usuario</h3>

        <form method="post" th:action="@{add}" th:object="${Usuario}">

          <!-- ========================================================= -->
          <!-- üßç DATOS PERSONALES -->
          <!-- ========================================================= -->
          <h5 class="text-secondary mb-3 border-bottom pb-2">Datos del Usuario</h5>

          <div class="row g-3">
            <div class="col-md-4">
              <label for="nombre" class="form-label fw-semibold">Nombre</label>
              <input type="text" class="form-control" name="nombre" th:field="*{Nombre}" placeholder="Pablito">
              <span class="error-msg text-danger"></span>
              <span th:if="${#fields.hasErrors('Nombre')}" th:errors="*{Nombre}" class="text-danger"></span>
            </div>

            <div class="col-md-4">
              <label for="apellidopaterno" class="form-label fw-semibold">Apellido Paterno</label>
              <input type="text" class="form-control" name="apellidopaterno" th:field="*{ApellidoPaterno}" placeholder="Cortez" onblur="SoloLetras(event,this)">
              <span th:if="${#fields.hasErrors('ApellidoPaterno')}" th:errors="*{ApellidoPaterno}" class="text-danger"></span>
            </div>

            <div class="col-md-4">
              <label for="apellidomaterno" class="form-label fw-semibold">Apellido Materno</label>
              <input type="text" class="form-control" name="apellidomaterno" th:field="*{ApellidoMaterno}" placeholder="Dominguez" onblur="SoloLetras(event,this)">
              <span th:if="${#fields.hasErrors('ApellidoMaterno')}" th:errors="*{ApellidoMaterno}" class="text-danger"></span>
            </div>

            <div class="col-md-3">
              <label class="form-label fw-semibold">Fecha Nacimiento</label>
              <input type="date" class="form-control" name="FechaNacimiento" th:field="*{FechaNacimiento}">
            </div>

            <div class="col-md-3">
              <label class="form-label fw-semibold">Tel√©fono</label>
              <input type="text" class="form-control" name="Telefono" th:field="*{Telefono}" placeholder="1279036391">
            </div>

            <div class="col-md-3">
              <label class="form-label fw-semibold">Celular</label>
              <input type="text" class="form-control" name="Celular" th:field="*{Celular}" placeholder="56172936338">
            </div>

            <div class="col-md-3">
              <label class="form-label fw-semibold">Email</label>
              <input type="text" class="form-control" name="Email" th:field="*{Email}" placeholder="correo@gmail.com">
            </div>

            <div class="col-md-4">
              <label class="form-label fw-semibold">Password</label>
              <input type="password" class="form-control" name="password" th:field="*{Password}">
            </div>

            <div class="col-md-4">
              <label class="form-label fw-semibold">Sexo</label>
              <select class="form-select" name="sexo" th:field="*{Sexo}">
                <option value="">Seleccione</option>
                <option value="MS">MS</option>
                <option value="FM">FM</option>
              </select>
            </div>

            <div class="col-md-4">
              <label class="form-label fw-semibold">User Name</label>
              <input type="text" class="form-control" name="username" th:field="*{UserName}" placeholder="cr43">
            </div>

            <div class="col-md-4">
              <label class="form-label fw-semibold">CURP</label>
              <input type="text" class="form-control" name="curp" th:field="*{CURP}">
            </div>
              
              <div class="col-md-4">
              <label class="form-label fw-semibold">Rol</label>
              <select class="form-select" name="rol" th:field="${Usuario.Rol.IdRols}">
                <option value="0" selected>Selecciona un Rol</option>
                <option th:each="rol : ${Rols}" th:value="${rol.IdRols}" th:text="${rol.NombreRol}"></option>
              </select>
            </div>
          </div>

          <h5 class="text-secondary mt-5 mb-3 border-bottom pb-2">Direcci√≥n</h5>

          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label fw-semibold">Calle</label>
              <input type="text" class="form-control" name="calle" th:field="*{Direcciones[0].Calle}">
            </div>

            <div class="col-md-4">
              <label class="form-label fw-semibold">N√∫mero Exterior</label>
              <input type="text" class="form-control" name="numeroexterior" th:field="*{Direcciones[0].NumeroExterior}">
            </div>

            <div class="col-md-4">
              <label class="form-label fw-semibold">N√∫mero Interior</label>
              <input type="text" class="form-control" name="numerointerior" th:field="*{Direcciones[0].NumeroInterior}">
            </div>

            <div class="col-md-4">
              <label class="form-label fw-semibold">Pa√≠s</label>
              <select class="form-select" id="ddlpais" th:field="*{Direcciones[0].Colonia.Municipio.Estado.Pais.IdPais}">
                <option value="0" selected>Selecciona un Pa√≠s</option>
                <option th:each="pais : ${Paises}" th:value="${pais.idPais}" th:text="${pais.Nombre}"></option>
              </select>
            </div>

            <div class="col-md-4">
              <label class="form-label fw-semibold">Estado</label>
              <select class="form-select" id="ddlestado" th:field="*{Direcciones[0].Colonia.Municipio.Estado.IdEstado}">
                <option value="0" selected>Selecciona un Estado</option>
                <option th:each="estado : ${Estados}" th:value="${estado.idPais}" th:text="${estado.Nombre}"></option>
              </select>
            </div>

            <div class="col-md-4">
              <label class="form-label fw-semibold">Municipio</label>
              <select class="form-select" id="ddlmunicipio" th:field="*{Direcciones[0].Colonia.Municipio.IdMunicipio}">
                <option value="0" selected>Selecciona un Municipio</option>
                <option th:each="municipio : ${municipio}" th:value="${municipio.idMunicipio}" th:text="${municipio.Nombre}"></option>
              </select>
            </div>

            <div class="col-md-4">
              <label class="form-label fw-semibold">Colonia</label>
              <select class="form-select" id="ddlcolonia" th:field="*{Direcciones[0].Colonia.IdColonia}">
                <option value="0" selected>Seleccione una Colonia</option>
                <option th:each="colonia : ${colonias}" th:value="${colonia.idColonia}" th:text="${colonia.Nombre}"></option>
              </select>
            </div>
          </div>

          <!-- Bot√≥n -->
          <div class="text-center mt-5">
            <button type="submit" class="btn btn-success px-5 py-2 fw-semibold">Agregar</button>
          </div>

        </form>
      </div>
    </div>
  </div>


  <!-- ========================================================= -->
  <!-- üé® CSS personalizado -->
  <!-- ========================================================= -->
 <style>
    body {
      background: #f8f9fa;
    }

    .card {
      max-width: 1100px;
      margin: auto;
      border-radius: 12px;
    }

    label {
      font-size: 0.95rem;
    }

    input.form-control,
    select.form-select {
      max-width: 100%;
    }

    .form-label {
      color: #444;
    }

    h5 {
      font-weight: 600;
    }

    button.btn-success {
      background-color: #198754;
      border: none;
    }

    button.btn-success:hover {
      background-color: #157347;
    }
  </style>
            
            <style>
                .correct{
                    border-color: greenyellow;
                }
                
                .error{
                    border-color: red;
                }
                
            </style>
            <script>

                $(document).ready(function(){
                console.log("Ya estoy funcionando");
                
                $("#ddlpais").change(function (){
                    $.ajax({
                        type: 'GET',
                        url: "/usuario/pais/" + $("#ddlpais").val(),
                        datatype: "json",
                        success: function (data, textStatus, jqXHR) {
                            
                            $("#ddlpais").empty();
                            $("#ddlpais").append("<option value= 0>Selecciona un pais</option>");
                            $.each(data.objects, function(i, pais){
                               $("#ddlpais").append("<option value= " + pais.idPais + "> " + pais.nombre + "</option>"); 
                            });
                             
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            alert ("no hay nada que cargar");
                        }
                    });
                });
                
                
                $("#ddlpais").change(function(){
                    
                    $.ajax({
                        type:'GET',
                        url:'/usuario/estado/' + $("#ddlpais").val(),
                        dataType: "JSON",
                        success: function(data){
                            $("#ddlestado").empty();
                            $.each(data.objects, function(i, estado){
                                $("#ddlestado").append("Selecciona un estado");
                               $("#ddlestado").append("<option value= " + estado.idEstado + "> " + estado.nombre + "</option>"); 
                            });
                            
                        },
                        error: function(exception){
                            alert("No se puedieron obtener datos");
                        }
                    });
                    
                });
                
                $("#ddlestado").change(function(){
                    
                    $.ajax({
                        type:'GET',
                        url:'/usuario/municipio/' + $("#ddlestado").val(),
                        dataType: "JSON",
                        success: function(data){
                            $("#ddlmunicipio").empty();
                            $.each(data.objects, function(i, municipio){
                                $("#ddlmunicipio").append("Selecciona un municipio");
                               $("#ddlmunicipio").append("<option value= " + municipio.idMunicipio + "> " + municipio.nombre + "</option>"); 
                            });
                            
                        },
                        error: function(exception){
                            alert("No se puedieron obtener datos");
                        }
                    });
                    
                });
                
                
                $("#ddlmunicipio").change(function(){
                    
                    $.ajax({
                        type:'GET',
                        url:'/usuario/colonia/' + $("#ddlmunicipio").val(),
                        dataType: "JSON",
                        success: function(data){
                            $("#ddlcolonia").empty();
                            $.each(data.objects, function(i, colonia){
                                $("#ddlcolonia").append("Selecciona un municipio");
                               $("#ddlcolonia").append("<option value= " + colonia.idColonia + "> " + colonia.nombre + "</option>"); 
                            });
                            
                        },
                        error: function(exception){
                            alert("No se puedieron obtener datos");
                        }
                    });
                    
                });
                
            });
            
            
                
//                function SoloLetras(event,input){
//                
//                let value = $(input).val();
//                
//                let RegExp = /^[A-Za-z√ën]+$/;
//                
//                if(RegExp.test(value)){
//                    
//                    $(input).removeClass("error").addClass("correct");
//                    $(input).siblings(".error-msg").text("");
//                }else{
//                    $(input).removeClass("correct").addClass("error");
//                    $(input).siblings(".error-msg").text("Este Campo solo se permiten letras, intente de nuevo, sin espacios en blanco al inicio y al final, donde comience con una letra Mayuscula al inicio");
//                    event.preventDefault();
//                }
//                
//                }
                
//                function FechaNacimientoVerd(event,input){
//                    
//                    var hoy = new Date();
//                    
//                }
                
//                function TelVerd(event,input){
//                    
//                    let value = event.key;
//                    
//                    let RegExp =  /\+*([0-9]{2,3})*\s*[0-9]{10}/g;
//                    
//                    if(RegExp.test(value)){
//                        $(input).removeClass("error").addClass("correct");
//                        $(input).siblings(".error-msg").text("");
//                        
//                    }else{
//                        $(input).removeClass("correct").addClass("error");
//                        $(input).siblings(".error-msg").text("Ingresa correctamente el numero de telefono");
//                        event.preventDefault();
//                    }
//                    
//                }
                
            </script>
    </body>
</html>